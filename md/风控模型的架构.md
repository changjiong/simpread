# 我现在来演示一下风控模型的架构 已付费


[雷帅快与慢](javascript:void(0);)

 *2024年08月19日 15:08* *北京*

***I now demonstrate the frame of the system of the world.\*** 我现在来演示一下世界的架构。

这句话出自艾萨克·牛顿 《自然哲学的数学原理 》卷三的引言。我看了卷三的主要内容，是关于宇宙的结构和运动，特别是天体的运动。这部分详细阐述了万有引力定律，以及如何使用它来解释行星轨道、潮汐现象等天文现象。

学习一下，我现在来演示一下风控模型的架构。但是什么内容能配得上这个标题呢？我陷入了无限的沉思……‍

1. 什么是好目标
2. 什么是好特征
3. 什么是好算法
4. 什么是好工程
5. 什么是好监控
6. 什么是好迭代

聊一聊这些问题吧。我竟然写了近五千字，就好像我在和我喜欢的朋友聊风控，巴不得所有的经验都分享给他一样。

在最后关头，我突然想何不加一些图表。于是我准备个示例，给出了模型开发过程中的一些关键图表，但我不会加任何说明。

***notes:\*** 数据是网上的 *germancredit* 数据集，按顺序我划分了*500,200,300*的训练测试跨时间样本，还虚构了一个 *month* 变量，假设是*5*个月的样本，只用了其中的数值型变量，每个特征随机置空了*20%*，*bad:1,good:0*，就这样。我一分钟都不愿意花在这样的事情上。

**1、什么是好目标**

信用风险当然是。无信不立，信用是可以看作是用户的某种属性的。虽然具体的计算口径往往是多长时间内逾期多少天，虽然其表现形式不完全等同于信用风险，但所谓本质不改。

欺诈风险也是，但要次之。因为你只能用***fpd\***近似，但欺诈和*fpd*不是等同关系，并不是*fpd*逾期的都是欺诈，也不是所有的欺诈都会*fpd*逾期，也可能是养号。

收入也算，但它不一样。收入在各种场景里都算得上是用户的关键标签，在所有场景都可靠的指标当然适合建模。当你对收入建模时，你不是预测未来的收入，而是预测当下的收入。按理说当下的信息不是预测，而是识别，只是因为确切的收入指标就那么几个源头：社保、公积金等，用少量样本确切的指标建模来推断全量，不失为好办法。

业务里非常关注三个指标：额度、余额和额度使用率。如果要当建模目标，余额比额度好，比额度使用率好。同理，消费金额也还行。‍但凡***c=f(a,b)\***的，预测*c*都不如预测*a*或*b*，如果你想要两个，那就预测*a*和*b*，不要预测*c*。例如***额度使用率=\**f(额度,余额)\***，那就预测余额。

也就是说，因变量不是一个好目标，策略变量当然也不是好目标，例如额度，那是策略结果。

什么时候变坏也不是一个好目标，因为这和什么时候出账有关，出账又由什么时候支用决定。预测什么时候变坏不如预测什么时候支用。

有很多数据服务商，为了让自己的数据产品版图好看一点，唬人一点，会做非常多的产品。但实际上很多产品是无效的。一套相同的特征，你可以对任何目标建模，但好目标没那么多。

例如有做响应评分的，这其实不是一个好目标，因为响应不是用户的基本特性，是用户和产品共同的结果，当然风险严格意义也是，但程度明显不同。在A产品的响应和B产品上的效应压根儿不是一回事。

之前我写了《[互联网金融中流行的20个模型](http://mp.weixin.qq.com/s?__biz=Mzg5NDY0NDY5MQ==&mid=2247485932&idx=1&sn=5283c46c9e12d4dbc12154bc9c65ecb5&chksm=c01d3150f76ab846dd69cb2eae76d7c279c3fd04ba797a401252158dbc5f5d45bf8800525f98&scene=21#wechat_redirect)》，这几大类二十几个模型都不是从算法的角度出发的，而是从建模目标的角度出发的。那是四千字的长文，可以去看一看，几乎涵盖了所有的好目标。我这一节并不是完全罗列，而是从某种原理上论述。

![图片](https://mmbiz.qpic.cn/sz_mmbiz_png/BxiafoSrOZ5qEV8iaJukfjK0YcWL8vVxQdqGqichLQM6ghASUibMmYC771hZpd7Hz1ArENowIZVPlR7UbkGiaAU6VBQ/640?wx_fmt=png&from=appmsg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

**2、什么是好特征**

特征可以分成主要特征和次要特征。诸位先生，请记住“**主要特征**”这个词。主要特征便是事情的本质，它是一种属性，别的属性都是根据一定的关系从主要特征引申出来的。

太抽象了，举个例子吧。大胆的速写和辛辣的漫画就是活生生的例子，主要特征被放大，次要特征被缩小，你却能精致识别出这个人。反过来肯定不行。‍‍‍‍‍‍‍‍‍‍‍

大家都知道，衡量风险的有两个维度，还款能力和还款意愿。硬要多说一个的话，是多头，因为多头背后是还款能力和还款意愿的某种修正。借来的*1w*块钱和*1w*的收入流水是完全不一样的，前者的还款能力没那么强，还款意愿随时也可能会打破。

还款能力，当然得从收入、消费等代表资金水平的信息中体现。所以，大家都很想要收入数据，其实电商消费、银联支付数据也很好，同理，支付宝账单、微信账单会非常好用。前面说真实收入的数据源很少，如果要做收入预测，应该用这里的消费数据，而不是其他弱相关甚至无关数据。

还款意愿是什么？一定要从还款历史中判断，当然了除非你有抵押物、社交关系等抓手。一个人没有借贷历史，你怎么判断别人有没有还款意愿？

最好的当然是己方产品的还款历史，这就是***B***卡效果好的原因。贷中因为有了用户的借还款行为，便可以通过*B*卡实现精细化管理。

在其他平台的还款历史呢？这就是征信，就是多头数据的意义。查询、借款、已还、待还、逾期，怎么能不重要？但是它的确越来越不重要了，因为大家的客群越来越同质。都是多头，都是高负债，都有逾期历史，它自然就不好用了。非战之罪也。

以上就是主要特征。离主要特征越近，特征就越好。当然特征要考虑冗余度，我们谈的是带来增量信息的特征。

你说什么是次要特征？

例如设备类特征，我将其理解为衍生特征，或者说抽象特征、高阶特征、深层特征、引申特征等等，就像前面说的*c=f(a,b)*一样。设备价值，这是收入水平的表征，安装了很多贷款类*app*，这是信贷特征的抽象。大抵如此。

还有运营商数据，通话通的是催收，也是信贷信息的抽象，高端服务的通话是高收入的抽象。

至于，搜索浏览，肉眼可见地离我们的中心点越来越远了。

![图片](https://mmbiz.qpic.cn/sz_mmbiz_png/BxiafoSrOZ5odyCAPLG52xmN2ObflibbhI7SB2R35e3xQT7WRr1icWVWGpHyTREq4s4HOKHQSMFKn1BkMfAT1Ocrw/640?wx_fmt=png&from=appmsg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

**3、什么是好算法**

其实，在应用科学领域，这是最微不足道的。*AI*，就是数学的游戏，这不能算贬义，因为数学真的是皇冠。

算法带来的超额效果很小。除了逻辑回归复杂度较低之外，*xgb*、*lgb*，神经网弱等学习能力都很强，算法的增益几乎可以忽略不计。

选择算法，最重要的是考虑部署问题。如果你们工程上只会逻辑回归的线性计算，那你就只能选逻辑回归。选择别的算法，要先解决工程问题。但其实都好解决，也不好解决，主要看系统能力，其次看个人能力。

从线性和非线性的角度说吧，逻辑回归当然是线性的，神经网络和树模型是非线性的。这个问题带来的结果是，线性的需要分客群，非线性的可能可以不特别需要分客群。为什么？

***ln(odds)=a1x1+a2x2+...\***，你看表达式就知道了，不同客群的系数矩阵***A\***肯定是不一样的，实际上连组成***X\***矩阵的***woe\***值都不一样。不一样的表达式，采用线性的方式强行合成一个，肯定是有损的。

那树模型呢？分客群可以看作第一层分裂进行了手动分群，其实还不如不分，留给算法自己分。如果你保证总的复杂度不变的话，我相信算法自己分效果会更好。

也就是说，假如分了***n\***个客群，建了*n*个模型，对比的那一个不分客群的模型，在相同的参数下，评估器的数量应该乘以*n*。

我们这里说的是做模型分不分客群。建模不分客群不代表策略不分客群，做策略的时候自行去划分就好了。

![图片](https://mmbiz.qpic.cn/sz_mmbiz_png/BxiafoSrOZ5odyCAPLG52xmN2ObflibbhIkADdh7vabRic0icvRYicCznBvXtEjTojMicmfsFXxVnmByBBQ4LaW4axtQ/640?wx_fmt=png&from=appmsg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

**4、什么是好工程**

第一原则，**别错**。

很多人会开发模型，但这其实一点用都没有，实习生也会开发模型，稍微会写代码的学过数学的都会开发模型。拿一个现成的数据集，按照某些流程训练一个模型，太容易了。

然后忘了生产。离线做了一堆乱七八糟的特征处理，想都没想过线上生产的问题，例如，***/n\******和******/(n-1)\***的问题，例如类别变量的mapping。还有，网格搜索调参，找到了非常离谱的模型结构，其实都是不懂。

怎么解决呢？你得先有这个意识，知就会行，最后通过一致性验证来保证。开发是一套数据处理和模型打分的逻辑，生产是另一套，只有通过真实的样本验证两种打分的一致性，你才能*100%*杜绝错误。

第二呢，**异常的处理**，包括性能不足的超时。

异常返回什么，超时返回什么，通过还是拒绝，不同的环节可能都不一样。不是特别强的风险拦截环节其实可以通过，留给决策流中的关键环节去拦截。但关键环节，拿不准的你得拦截。

还有模型所用的字段，解析出现异常，或者接口未查询到，如何处理，不难，但你最好心里有数。

很多时候，你要兼顾某些你当前未知的异常情况，也要优化取数、计算的逻辑，至少得满足超时的性能要求吧。

第三，**数据的存储**，要考虑到数据的分析、利用、排查问题等各种用途。

如果一切都好，模型分是对的，分布是稳定的，效果又好又稳定，业务指标也很好，什么都不做当然也可能没啥问题。但没有人能保证，不，我保证一定不会这样好。

任何环节出现波动，你一定免不了要来分析模型。分布也好，效果也好，意味着线上调用的模型分需要存储。不仅如此，模型分所用到的字段也应该存储。

好好理解下接下来说的监控吧，你就会知道，风控模型从来不是训练一个模型而已。

![图片](https://mmbiz.qpic.cn/sz_mmbiz_png/BxiafoSrOZ5odyCAPLG52xmN2ObflibbhIX1MicYaibUpflibyU4FWopgZ4TUWZRpM0pWykDDEEGD3HibVkiaMauU5oug/640?wx_fmt=png&from=appmsg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

**5、什么是好监控**

好的监控，一定不只是展示某种结果，还要提供发现问题的路径。

如果监控发现了异常，难不成还要另做一套分析吗？不需要的，你的监控应该包括这部分功能。那怎么做呢？

监控转化路径，监控模型效果，做好趋势分析，对比对比，细分分析。光有一个数据是没有意义的，比较才能使其有洞见，怎么比？和过去比，和其他的比，分开了自己比。

这些我全写在《[不监控不风控](http://mp.weixin.qq.com/s?__biz=Mzg5NDY0NDY5MQ==&mid=2247484617&idx=1&sn=edde751133980d4339452041cbe48c27&chksm=c01d3c75f76ab563c42f04f2ef9afa06226be43b7355dc45bdfe5e2ad38f0e3fe7275b27c691&scene=21#wechat_redirect)》这篇文章里了，想不到我*21*年的文章就写得这么棒。

例如***ks\***下降了很多，你应该干什么？这等于，跟*ks*有关的有什么，那有什么呢？不要看，先想想，朋友们。

**客群**，不同的客群*ks*肯定是不一样的；**通过率**，通过率发生变化，*ks*也会有影响；**风险**，其实风险是不太会直接改变*ks*结果的，如果这里的风险变化是自变量而不是因变量的话。这里的意思是，什么都没变，风险发生了变化，例如疫情，其实*ks*不怎么变的，下一节还会提到。如果风险发生了变化，其实是因为收缩了策略降低了通过率，那它就不是自变量。

这在你的监控里得体现出来。如果只是一个*ks*，你就看不到客群，看不到通过率，看不到风险变化。

当然了，还有一个可能，那就是你的模型生产出问题了。实时模型的话线上字段发生了变化，工程上没顾及到，离线模型的话，则可能是特征字段或者依赖关系出问题了。但这些更应该在发生初期通过分布监控告警而知，而不是几个月后发现*KS*有问题。

于是，你还应该对比其他的模型。如果所有的模型都发生同样的趋势变化，你还担心某个模型是否异常吗？

![图片](https://mmbiz.qpic.cn/sz_mmbiz_png/BxiafoSrOZ5odyCAPLG52xmN2ObflibbhIU3KwB0VknC2wWKsNqoU6ia86W4QiaXlXHIkGe1UuIkLbBouu8qafamEw/640?wx_fmt=png&from=appmsg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

**6、什么是好迭代**

你的业务发生了巨大的变化，应该进行迭代尝试。

你的数据源发生了变更，引入了新的，下线了旧的，应该进行迭代尝试。

时间过了很久，样本逐渐偏移，应该进行迭代尝试。

迭代是为了解决不适用问题，解决衰减问题，不是为了解决模型上线后效果突变问题，更不是解决没事找事干唬人的问题。

对于信用风险来说，我说样本没那么容易变化，你说迭代是为了应付策略变化，有意思。实际上，应对策略变化的模型迭代，就不应该是快速迭代，而是按需迭代。你要说策略天天都在变化，因为模型在频繁迭代，套瓷了，朋友们，互为因果了。

好的迭代，需要明确你的优化点，这个优化点无非就是三个：***X\***、***y\***和***y=f(X)\***的***f\***。

***X\***是你的特征，这个不必说，当你辛辛苦苦开发或者迭代了特征的时候，没有人提需求你也想迭代你的模型。

***y\*** 是风险表现，其实这个本身都是可靠的，你可以认为策略会影响风险表现，所以这里的y指的是策略变化。

***f\*** 是用户的风险关系，可以理解成样本变化，时间因素应该归为此类。但实际上很复杂，像疫情期间，所有客群风险都几乎等比例变高，*f*是变了，但如果是常量偏移的话，也不用迭代。

这些优化点需要通过前面的监控感知到，这是对监控的要求，也是某种指引。

关于迭代，我已经写了三篇了，我几乎没有任何想补充的了。

1. [关于那个新老策略模型孰好孰劣的问题](http://mp.weixin.qq.com/s?__biz=Mzg5NDY0NDY5MQ==&mid=2247485408&idx=1&sn=364d45ab280dd6dbf4cdf3dd2593b1f0&chksm=c01d3f5cf76ab64af5eff407fdd1c453609d97cecc31a282516cbb8586930c549c837570b5be&scene=21#wechat_redirect)
2. [为什么模型快速迭代不一定有效](http://mp.weixin.qq.com/s?__biz=Mzg5NDY0NDY5MQ==&mid=2247485895&idx=1&sn=d2a8e4b7ba1d4a1473e18f880ea46aae&chksm=c01d317bf76ab86df9cef52662bbb7f2a866a0d9c820f34e0a2edce1e67c348406f79288666b&scene=21#wechat_redirect)
3. [模型快速迭代没有用，模型融合就有用吗](http://mp.weixin.qq.com/s?__biz=Mzg5NDY0NDY5MQ==&mid=2247485984&idx=1&sn=43ec91f6be46f00b8556ca29315043c0&chksm=c01d329cf76abb8acebd0325de74ab7f03e235a0ec0ce724e20f563c4a1908afdd06bcf32726&scene=21#wechat_redirect)

![图片](https://mmbiz.qpic.cn/sz_mmbiz_png/BxiafoSrOZ5pib3cpiaZg3ohaqgOrwWxFjZabXSJibUWG3Gsr9datwdIzicicNicS64YTu2icp0FjEmRVmzEX8ibhHGuyCA/640?wx_fmt=other&from=appmsg&wxfrom=5&wx_lazy=1&wx_co=1&tp=webp)

……

现在我们该做一次总结了。诸位先生，我们可以回顾一下走过来的路程。

我们依次论述了建模的关键要素，包括标签、特征、算法，其实还有一个样本很重要，在通用模型例如芝麻信用分、三方数据的评分等，需要结合问题和目标考虑，但我们并未详述。然后又论述了保障模型生产服务的重要环节，包括工程部署、监控和迭代。

将他们合起来，就可以得到风控模型的架构了：

一个好目标，用好的特征，在好的样本上，通过合适的算法，就可以得到一个好模型；在正确的部署下，做好监控，持续跟踪，进行必要的迭代，就得到了一个持续为你服务的好模型。
